<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>User Login â€“ NBVS</title>

  <style>
    body {
      margin: 0;
      font-family: Inter, sans-serif;
      background: linear-gradient(140deg, #0d1f1f, #001a12 50%, #002c1c);
      color: white;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
    }

    .card {
      background: rgba(255,255,255,0.06);
      backdrop-filter: blur(8px);
      padding: 32px;
      width: 90%;
      max-width: 420px;
      border-radius: 14px;
      box-shadow: 0 12px 30px rgba(0,0,0,0.35);
    }

    h2 {
      text-align: center;
      margin-bottom: 20px;
      font-size: 24px;
    }

    input {
      width: 100%;
      margin-top: 10px;
      padding: 14px;
      border-radius: 8px;
      border: none;
      background: rgba(255,255,255,0.12);
      color: white;
    }

    button {
      width: 100%;
      margin-top: 18px;
      padding: 14px;
      background: #00d46a;
      color: #002012;
      font-weight: 700;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 16px;
    }
    button:hover {
      background: #00b85a;
    }

    .note { margin-top: 10px; font-size: 14px; color: #ddd; }
  </style>
</head>

<body>
  <div class="card">
    <h2>NBVS User Login</h2>

    <input id="email" placeholder="Email">
    <input id="password" type="password" placeholder="Password">
    <button id="loginBtn">Sign In</button>

    <div class="note" id="note"></div>
  </div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-app.js";
import { getAuth, signInWithEmailAndPassword, onAuthStateChanged } 
  from "https://www.gstatic.com/firebasejs/10.11.0/firebase-auth.js";
import { getFirestore, doc, getDoc } 
  from "https://www.gstatic.com/firebasejs/10.11.0/firebase-firestore.js";

const firebaseConfig = {  
  apiKey: "AIzaSyCDh_qL3jiCMHROK0_Soul2Wsv3t3y4wv0",
  authDomain: "nbvs-ghana.firebaseapp.com",
  projectId: "nbvs-ghana",
  storageBucket: "nbvs-ghana.firebasestorage.app",
  messagingSenderId: "702636577113",
  appId: "1:702636577113:web:8369b43a2aa43aeb95fc48",
  measurementId: "G-2FHFSQRMZX"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

const emailEl = document.getElementById("email");
const passEl = document.getElementById("password");
const noteEl = document.getElementById("note");
const btn = document.getElementById("loginBtn");

btn.onclick = async () => {
  noteEl.textContent = "";
  try {
    const email = emailEl.value.trim();
    const pwd = passEl.value.trim();
    if(!email || !pwd) return noteEl.textContent = "Enter email + password.";

    const res = await signInWithEmailAndPassword(auth, email, pwd);

  } catch(err) {
    noteEl.textContent = err.message;
  }
};

onAuthStateChanged(auth, async user => {
  if(!user) return;

  const snap = await getDoc(doc(db,"users",user.uid));
  if(!snap.exists()) return noteEl.textContent = "No user record found.";

  const role = snap.data().role;

  if(role !== "user") {
    noteEl.textContent = "Not a user account.";
    return;
  }

  window.location.href = "user-dashboard.html";
});
</script>
</body>
</html>
