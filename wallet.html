<!DOCTYPE html>
<html>
<head>
  <title>NBVS Wallet</title>
  <style>
    body{font-family:Arial;background:#f8f9fa;padding:20px}
    h1{color:#006b3f}
    .panel{background:#fff;padding:15px;border-radius:8px;box-shadow:0 2px 6px rgba(0,0,0,0.1);margin-top:15px}
    table{width:100%;margin-top:15px;border-collapse:collapse}
    th,td{border:1px solid #ccc;padding:10px}
    th{background:#006b3f;color:#fff}
    button{background:#006b3f;color:#fff;padding:10px 15px;border:none;border-radius:6px;cursor:pointer}
  </style>
</head>

<body>
<h1>Wallet</h1>

<div class="panel">
  <p><b>Balance:</b> ¢<span id="balance">0</span></p>
  <button id="addCreditBtn">Add ¢30 Credit</button>
</div>

<div class="panel">
  <h3>Transactions</h3>
  <table>
    <thead><tr><th>Amount</th><th>Type</th><th>Time</th></tr></thead>
    <tbody id="walletLogs"></tbody>
  </table>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.2/firebase-app.js";
import { getFirestore, doc, getDoc, updateDoc, collection, addDoc } from "https://www.gstatic.com/firebasejs/10.7.2/firebase-firestore.js";

const firebaseConfig = {
  apiKey:"AIzaSyCDh_qL3jiCMHROK0_Soul2Wsv3t3y4wv0",
  authDomain:"nbvs-ghana.firebaseapp.com",
  projectId:"nbvs-ghana",
  storageBucket:"nbvs-ghana.firebasestorage.app",
  messagingSenderId:"702636577113",
  appId:"1:702636577113:web:8369b43a2aa43aeb95fc48"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

const walletRef = doc(db,"wallet","publicUser");
const logsRef = collection(db,"wallet_transactions");

async function initWallet(){
  const snap = await getDoc(walletRef);
  if(!snap.exists()){
    await updateDoc(walletRef,{balance:0});
  }
}

async function loadWallet(){
  const user = await getDoc(walletRef);
  document.getElementById("balance").textContent = user.data().balance;
}

document.getElementById("addCreditBtn").addEventListener("click",async()=>{
  const snap = await getDoc(walletRef);
  let bal = snap.data().balance + 30;

  await updateDoc(walletRef,{balance:bal});
  await addDoc(logsRef,{
    amount:"+30",
    type:"credit",
    time:new Date()
  });

  loadWallet();
  alert("✅ Added ¢30 to wallet.");
});

initWallet();
loadWallet();
</script>

</body>
</html>
