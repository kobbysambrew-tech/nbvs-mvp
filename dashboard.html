<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>NBVS Ghana - Admin Dashboard</title>
  <style>
    body { font-family: Arial, sans-serif; background:#f8f9fa; margin:0; padding:0; }
    header { background:linear-gradient(to right,#ce1126,#fcd116,#006b3f); color:white; text-align:center; padding:1.4em; }
    main { max-width:850px; margin:2em auto; background:white; padding:2em; border-radius:12px; box-shadow:0 3px 8px rgba(0,0,0,0.1); }
    input, select { width:100%; padding:10px; margin:8px 0; border:1px solid #ccc; border-radius:6px; }
    button { background:#006b3f; color:white; padding:10px 16px; border:none; border-radius:6px; cursor:pointer; }
    button:hover { background:#004f2e; }
    .warn { background:#ce1126; }
    .warn:hover { background:#9b0c1b; }
    .hidden { display:none; }
    .record { background:#f9f9f9; border-left:4px solid #006b3f; padding:15px; margin-top:15px; }
  </style>
</head>
<body>

<header>
  <h1>NBVS Ghana — Admin Dashboard</h1>
</header>

<main>

  <!-- ✅ LOGIN PANEL -->
  <section id="loginPanel">
    <h2>Admin Login</h2>
    <input type="password" id="adminPass" placeholder="Enter admin password" />
    <button id="loginBtn">Login</button>
    <p id="loginMsg" style="color:#c00;"></p>
  </section>

  <!-- ✅ ADMIN PANEL -->
  <section id="adminPanel" class="hidden">

    <h2>Add New Record</h2>
    <input id="name" placeholder="Full Name" />
    <input id="nia" placeholder="NIA ID" />
    <input id="dob" placeholder="Date of Birth" />
    <input id="region" placeholder="Region" />
    <input id="criminal" placeholder="Criminal Record" />
    <input id="driving" placeholder="Driving License" />
    <input id="address" placeholder="Address" />
    <input id="credit" placeholder="Credit Score" />
    <select id="status">
      <option value="Verified">Verified</option>
      <option value="Pending">Pending</option>
    </select>
    <button id="addRecordBtn">Add Record</button>

    <hr />

    <h2>Search Records</h2>
    <input id="searchInput" placeholder="Search by Name or NIA ID" />
    <button id="searchBtn">Search</button>
    <button id="showAllBtn">Show All</button>
    <button id="analyticsBtn">Analytics</button>
    <div id="results"></div>

    <hr />
    <button id="logoutBtn" class="warn">Logout</button>

  </section>

</main>

<footer>
  © 2025 NBVS Ghana — National Background Verification System
</footer>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.2/firebase-app.js";
  import { getAuth, signInWithEmailAndPassword, signOut } from "https://www.gstatic.com/firebasejs/10.7.2/firebase-auth.js";
  import { getFirestore, collection, addDoc, getDocs } from "https://www.gstatic.com/firebasejs/10.7.2/firebase-firestore.js";

  // ✅ Firebase Config
  const firebaseConfig = {
    apiKey: "AIzaSyCDh_qL3jiCMHROK0_Soul2Wsv3t3y4wv0",
    authDomain: "nbvs-ghana.firebaseapp.com",
    projectId: "nbvs-ghana",
    storageBucket: "nbvs-ghana.firebasestorage.app",
    messagingSenderId: "702636577113",
    appId: "1:702636577113:web:8369b43a2aa43aeb95fc48",
    measurementId: "G-2FHFSQRMZX"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);
  const auth = getAuth(app);

  const loginPanel = document.getElementById("loginPanel");
  const adminPanel = document.getElementById("adminPanel");
  const loginBtn = document.getElementById("loginBtn");
  const loginMsg = document.getElementById("loginMsg");
  const logoutBtn = document.getElementById("logoutBtn");

  /** ✅ LOGIN */
  loginBtn.addEventListener("click", async () => {
    const email = "admin@nbvsghana.com";
    const password = document.getElementById("adminPass").value.trim();

    try {
      await signInWithEmailAndPassword(auth, email, password);

      loginPanel.classList.add("hidden");
      adminPanel.classList.remove("hidden");

      alert("✅ Admin access granted");
    } catch (err) {
      loginMsg.textContent = "❌ Wrong password!";
    }
  });

  /** ✅ AUTO LOGIN */
  auth.onAuthStateChanged((user) => {
    if (user) {
      loginPanel.classList.add("hidden");
      adminPanel.classList.remove("hidden");
    }
  });

  /** ✅ LOGOUT */
  logoutBtn.addEventListener("click", async () => {
    await signOut(auth);
    location.reload();
  });

  /** ✅ ADD RECORD */
  document.getElementById("addRecordBtn").addEventListener("click", async () => {
    const data = {
      name: document.getElementById("name").value.trim(),
      nia: document.getElementById("nia").value.trim(),
      dob: document.getElementById("dob").value.trim(),
      region: document.getElementById("region").value.trim(),
      criminal: document.getElementById("criminal").value.trim(),
      driving: document.getElementById("driving").value.trim(),
      address: document.getElementById("address").value.trim(),
      credit: document.getElementById("credit").value.trim(),
      status: document.getElementById("status").value
    };

    if (!data.name || !data.nia) {
      alert("⚠️ Name & NIA ID required");
      return;
    }

    try {
      await addDoc(collection(db, "records"), data);
      alert("✅ Record saved!");
    } catch (err) {
      console.error(err);
      alert("❌ Error saving record");
    }
  });

  /** ✅ SEARCH */
  document.getElementById("searchBtn").addEventListener("click", async () => {
    const q = document.getElementById("searchInput").value.trim().toLowerCase();
    const results = document.getElementById("results");
    results.innerHTML = "Searching...";

    const docs = await getDocs(collection(db, "records"));
    let found = [];

    docs.forEach(doc => {
      const r = doc.data();
      if (r.name?.toLowerCase() === q || r.nia?.toLowerCase() === q) {
        found.push(r);
      }
    });

    if (!found.length) {
      results.innerHTML = "❌ No record found.";
      return;
    }

    results.innerHTML = "";
    found.forEach(r => {
      results.innerHTML += `
        <div class="record">
          <h3>${r.name} — ${r.status}</h3>
          <p>NIA: ${r.nia}</p>
          <p>DOB: ${r.dob}</p>
          <p>Region: ${r.region}</p>
          <p>Address: ${r.address}</p>
          <p>Criminal: ${r.criminal}</p>
          <p>Driving: ${r.driving}</p>
          <p>Credit: ${r.credit}</p>
        </div>
      `;
    });
  });

  /** ✅ SHOW ALL */
  document.getElementById("showAllBtn").addEventListener("click", async () => {
    const results = document.getElementById("results");
    results.innerHTML = "Loading...";

    const docs = await getDocs(collection(db, "records"));
    results.innerHTML = "";

    docs.forEach(doc => {
      const r = doc.data();
      results.innerHTML += `
        <div class="record">
          <h3>${r.name} — ${r.status}</h3>
          <p>NIA: ${r.nia}</p>
          <p>Region: ${r.region}</p>
        </div>
      `;
    });
  });

  /** ✅ ANALYTICS */
  document.getElementById("analyticsBtn").addEventListener("click", () => {
    window.location.href = "analytics.html";
  });

</script>

</body>
</html>
